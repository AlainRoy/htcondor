all_target( util_lib.a stub_gen )

CFLAGS = $(STD_C_FLAGS)

#if MALLOC_DEBUG
MALLOC_OBJ = malloc.o
#endif

#if !HAS_FLOCK
FLOCK_OBJ = flock.o
#endif

#if !HAS_SETREUID
SETREUID_OBJ = setreuid.o
#endif

#if !HAS_SETEUID
SETEUID_OBJ = seteuid.o
#endif

#if !HAS_SETREGID
SETREGID_OBJ = setregid.o
#endif

#if !HAS_SETRGID
SETRGID_OBJ = setrgid.o
#endif

#if !HAS_SETEGID
SETEGID_OBJ = setegid.o
#endif

#if !HAS_GETDTABLESIZE
GETDTABLESIZE_OBJ = getdtablesize.o
#endif

#if !HAS_GETWD
GETWD_OBJ = getwd.o
#endif

#if !HAS_GETPAGESIZE
GETPAGESIZE_OBJ = getpagesize.o
#endif

#if !HAS_SETLINEBUF
SETLINEBUF_OBJ = setlinebuf.o
#endif

#if NEEDS_FAKE_GETMNT
GETMNT_OBJ = getmnt.o
#endif

#if !HAS_INET_NTOA
INET_NTOA_OBJ = inet_ntoa.o
#endif

#define ObjectFiles \
	blankline.o do_connect.o except.o \
	dprintf.o dprintf_common.o dprintf_config.o \
	ltrunc.o mkargv.o proc.o signames.o \
	stricmp.o \
	getParam.o \
	ctrace.o detach.o update_rusage.o cronos.o \
	$(FLOCK_OBJ) \
	$(SETREUID_OBJ) email.o email_file.o \
	$(GETDTABLESIZE_OBJ) $(SETRGID_OBJ) $(SETREGID_OBJ) $(MALLOC_OBJ)\
	$(SETEGID_OBJ) $(SETEUID_OBJ) $(GETPAGESIZE_OBJ) $(SETLINEBUF_OBJ) \
	$(GETWD_OBJ) env_param.o ckpt_name.o \
	lock_file.NON_POSIX.o my_popen.o $(GETMNT_OBJ) $(INET_NTOA_OBJ) \
	syscall_numbers.o sig_install.o internet.o startup_info.o escapes.o\
	ckpt_util.o get_random_num.o fdprintf.o rotate_file.o \
	setsyscalls.o match_prefix.o sleep.o basename.o strcmp_until.o\
	filename_tools.o d_format_time.o chomp.o strupr.o globus_utils.o

test.o: test.c
	gcc $(CFLAGS) -c test.c

test: test.o util_lib.a
	gcc $(CFLAGS) -o test test.o util_lib.a

library_target(util_lib.a,ObjectFiles)

y.tab.o: y.tab.c
	gcc $(CFLAGS) -c y.tab.c

lex.yy.o: lex.yy.c
	gcc $(CFLAGS) -c lex.yy.c

stub_gen: y.tab.o lex.yy.o
	gcc $(CFLAGS) -o stub_gen y.tab.o lex.yy.o $(ALL_LDFLAGS)

clean::
	rm -f stub_gen y.tab.o lex.yy.o 

lex.yy.c: stub_gen_lex.l scanner.h y.tab.h
	lex stub_gen_lex.l
clean::
	rm -f lex.yy.c

y.tab.h: y.tab.c

y.tab.c: stub_gen_yacc.y scanner.h
	YACC -d stub_gen_yacc.y
clean::
	rm -f y.tab.c y.tab.h

IMPORT_LINKS = ../../config/import_links
import(../h,syscall_numbers.c)

release:: all
stripped:: all
static:: all
html:
