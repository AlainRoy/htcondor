#if IS_MIPS_ULTRIX42 || IS_SPARC_SUNOS41 || IS_HPPAR_HPUX9
CC = gcc
#endif

C_PLUS_FLAGS = $(STD_C_PLUS_FLAGS) $(STATIC)

#if IS_R6000_AIX32
CFLAGS = $(STD_C_FLAGS) -qsrcmsg
#else
CFLAGS = $(STD_C_FLAGS)
#endif

SRC_DIR = $(SRC_TREE)/condor_ckpt

OS = OperatingSystem


#if IS_HPPAR_HPUX9
ASSEMBLER_SRC = get_reginfo.HPUX.s
ASSEMBLER_OBJ = get_reginfo.HPUX.o
.s.o:
	as /lib/pcc_prefix.s $<
#endif

#if IS_R6000_AIX32
ASSEMBLER_SRC = _longjmp.AIX32.s
ASSEMBLER_OBJ = _longjmp.AIX32.o
.s.o:
	m4 /usr/include/sys/asdef.s $*.s | as -o $*.o
#endif

UTIL_OBJ = dprintf.o dprintf_config.o except.o condor_errlst.o
SRC =	image.C machdep.$(OS).C file_state.C tmp_stack.C syscall_mode.c \
		local_startup.c fake_remote_syscall.c

#if DOES_CHECKPOINTING
OBJ =	image.o machdep.$(OS).o file_state.o tmp_stack.o syscall_mode.o \
		local_startup.o fake_remote_syscall.o $(ASSEMBLER_OBJ) $(UTIL_OBJ)
#else
OBJ =	syscall_mode.o
#endif

#if DOES_CHECKPOINTING
	all_target(machdep_test libckpt.a c_plus_alloc.o)
	library_target(libckpt.a,$(OBJ))
	release_library(libckpt.a,$(RELEASE_DIR)/lib)
	release_target(c_plus_alloc.o,$(RELEASE_DIR)/lib,OBJECT_MODE)
#else
	all_target(syscall_mode.o)
release:: all
#endif

depend_target($(SRC) )

program_target(machdep_test,machdep_test.o machdep.$(OS).o tmp_stack.o, )


IMPORT_LINKS = ../../config/import_links
import(../condor_util_lib,$(UTIL_OBJ))

clean::
	rm -f c_plus_alloc.o syscall_mode.o
