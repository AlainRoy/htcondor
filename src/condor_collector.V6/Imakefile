NAME = condor_collector
all_target(collector_engine.a $(NAME))

CFLAGS = $(STD_C_FLAGS)
C_PLUS_FLAGS = $(STD_C_PLUS_FLAGS)
LIB = collector_engine.a $(DAEMONCORE_LIB) $(STD_LIBS) $(CONFIGURE_GSOAP_LDFLAGS)

ENGINE_OBJ = hashkey.o collector_engine.o

#if HAVE_DLOPEN
# define PluginObj CollectorPlugin.o offline_plugin.o
#else
# define PluginObj
#endif

%-plugin.so: %.cpp
	$(CPlusPlus) $(C_PLUS_FLAGS) -shared $< -o $@

soapobjs(collector)

OBJ = $(SOAP_OBJS) \
      collector_main.o collector.o view_server.o \
      collector_instantiate.o totals.o collector_stats.o PluginObj

library_target(collector_engine.a, $(ENGINE_OBJ))

public_c_plus_target($(NAME),sbin,$(OBJ),$(LIB))

IMPORT_LINKS = ../../config/import_links
import_objs(../condor_status.V6,totals.o)

gen_soapfiles(collector,condorCollector)

html:
testbin:: all
