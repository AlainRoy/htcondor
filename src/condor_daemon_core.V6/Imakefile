all_target(daemon_core.a)

/* Compiling daemon core without -O produces an internal compiler error
	on alpha linux with gcc 2.95.2. I turned on optimization to
	get a different instruction scheduling path to fix it. -psilord
	7/5/01 */
#if IS_LINUX
#if IS_ALPHA
FIX_BROKEN_GCC = -O
#else
FIX_BROKEN_GCC =
#endif
#endif

#if HAS_PURIFY
PURIFY_FLAG = -DHAS_PURIFY
#else
PURIFY_FLAG =
#endif

#if HAVE_EXT_GSOAP
GSOAP_OBJS = soap_core.o httpget.o
#endif

CFLAGS = $(STD_C_FLAGS)
C_PLUS_FLAGS = $(STD_C_PLUS_FLAGS) $(FIX_BROKEN_GCC) $(PURIFY_FLAG) $(GSOAP_FLAGS)
LIB = $(STD_LIBS) $(CONFIGURE_GSOAP_LDFLAGS)

OBJ = $(GSOAP_OBJS) timer_manager.o daemon_core.o daemon_core_main.o \
  daemon_core_instantiate.o condor_perms.o \
  condor_lock_base.o condor_lock_implementation.o condor_lock_file.o \
  condor_lock.o self_monitor.o datathread.o self_draining_queue.o \
  HookClient.o HookClientMgr.o 

library_target(daemon_core.a,$(OBJ))
c_plus_target(testit,test_daemon_core.o daemon_core.a,$(LIB))
html_target( documentation )

release:: all
stripped:: all
static:: all

#if HAVE_EXT_GSOAP
soap_core.cc:: ../condor_includes/stdsoap2.h
../condor_includes/stdsoap2.h:
	cp $(GSOAP_DIR)/include/stdsoap2.h ../condor_includes/
	patch -p0 -d ../condor_includes < stdsoap2.h.patch
#endif

IMPORT_LINKS = ../../config/import_links
import_objs(../condor_util_lib,condor_perms.o)

testbin:: all
