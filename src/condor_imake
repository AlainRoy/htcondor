#!/bin/sh

gss="no"
if [ "$1" = "-DGSS_AUTHENTICATION" ]; then
	gss="Y"
	shift;
fi

if [ $# -gt 0 ]; then
	imake -s Makefile $* -I../config -I../../config
	exit 0
fi

arch=`uname -m`
osversion=`uname -r`
# Make sure if we get back something that begins with "IRIX" that we
# strip off anything after it (e.g. "IRIX64", etc).
os=`uname -s | sed 's/IRIX.*/IRIX/'`

ArchFlag=""
Opsys=""
Other=""

if [ $os = "HP-UX" -a $osversion = "B.10.20" ] ; then
	Opsys="-DIS_HPUX10"

elif [ $os = "OSF1" -a $osversion = "V4.0" ] ; then
	Opsys="-DIS_DUX4"

elif [ $os = "Linux" ]; then
	Opsys="-DIS_LINUX"
	if [ -f /lib/libc.so.6* ] ; then
		Other="-DIS_GLIBC"
	fi
	if [ $arch = "i686" -o $arch = "i586" -o $arch = "i486" ] ; then
		ArchFlag="-DIS_I386"
	elif [ $arch = "alpha" ] ; then
		ArchFlag="-DIS_ALPHA"
	fi

elif [ $os = "SunOS" ]; then
	if [ $arch = "sun4m" -o $arch = "sun4u" ]; then
		ArchFlag="-DIS_SUN4X"
	elif [ $arch = "i86pc" ]; then
		ArchFlag="-DIS_X86"
	fi

	if [ $osversion = "5.5.1" ] ; then
		Opsys="-DIS_SOLARIS251"
	elif [ $osversion = "5.6" ] ; then
		Opsys="-DIS_SOLARIS26"
	fi

elif [ $os = "IRIX" ] ; then
	if [ $osversion = "6.5" ] ; then
		Opsys="-DIS_IRIX65"
	else
		Opsys="-DIS_IRIX62"
	fi

fi

GssAuth=""
if [ $gss = "Y" ]; then
	if [ -f /p/condor/workspaces/globus/lib/libglobus_gss.a ] ; then
		GssAuth="-DGSS_AUTHENTICATION"
	fi
fi

imake -s Makefile $ArchFlag $Opsys $Other $GssAuth -I../config -I../../config
