%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{\label{sec:History-6-6}Stable Release Series 6.6}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

This is a stable release series of Condor.
It is based on the 6.5 development series.
All new features added or bugs fixed in the 6.5 series are available
in the 6.6 series.
The details of each version are described below.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{\label{sec:New-6-6-1}Version 6.6.1}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent Release Notes:

\begin{itemize}

\item \Condor{analyze} is not included in the downloads of Version 6.6.1.
  The existing binary from Version 6.6.0 is likely to work on all platforms
  for which it was released.

\end{itemize}


\noindent New Features:

\begin{itemize}

\item Added full support (including standard universe jobs with
  checkpointing and remote system calls) for Linux i386 RedHat 9
  (using gcc/g++ version 3.2.2 and glibc version 2.3.2). 

\item Added full support (including standard universe jobs with
  checkpointing and remote system calls) for Linux i386 RedHat 8
  (using gcc/g++ version 3.2 and glibc version 2.2.93). 

\item The time it takes \Condor{dagman} to submit jobs has been
      reduced slightly to improve up the startup time of large DAGs.

\item In order to help reduce load on the \Condor{schedd} when
      \Condor{dagman} is submitting jobs, there is a new config
      variable, \Macro{DAGMAN\_SUBMIT\_DELAY}, to specify the number
      of seconds \Condor{dagman} will sleep before submitting each
      job.

\item Enabled the ``update statistics'' in the \Condor{collector} by
      default in both the executable and in the default configuration.

\item Command-line arguments to \Condor{dagman} are now handled
      case-insensitively.

% commented out since i'm not sure we want to make a big deal of this
% new config file knob. -derek 1/12/04
% \item Added a new configuration macro
%     \Macro{MAX\_CLAIM\_ALIVES\_MISSED}, described on
%     page~\pageref{param:MaxClaimAlivesMissed}.
%     This setting controls how many keep alive messages a startd is
%     willing to miss before it releases the claim from a given schedd.

\item Added support for Condor-G and strong authentication to Condor
  for IRIX 6.5, but removed support for checkpointing and remote
  system calls.
  We plan to add support in Condor for IRIX's kernel-level
  checkpointing in a future release.

\item Added a \Opt{-p} option to \Condor{store\_cred} so that users
can now specify the the password on the command line instead of getting
prompted for it.

\item The gahp\_server helper process for Condor-G includes patches from
the LHC Computing Grid Project to increase data transfer performance of
the Condor-G client. Previous versions of Condor-G could bog down in
accepting new transfer requests, producing a variety of errors. 

\item Added a new configuration setting,
  \Macro{SUBMIT\_SEND\_RESCHEDULE} which controls whether or not
  \Condor{submit} should automatically send a \Condor{reschedule}
  command when it is done.
  Previously, \Condor{submit} would always send this reschedule so
  that the \Condor{schedd} knew to start trying to find matches for
  the new jobs.
  However, for submit machines that are managing a huge number of jobs
  (thousands or tens of thousands), this step would hurt performance
  in such a way that it became an obsticle to scalability.
  In this case, an administrator can set
  \MacroNI{SUBMIT\_SEND\_RESCHEDULE} to \verb@FALSE@, this extra
  step is not performed, and the \Condor{schedd} will try to find
  matches whenever the periodic timer in the \Condor{negotiator}
  (\MacroNI{NEGOTIATOR\_INTERVAL}) goes off.

\item Pool administrators can now specify the length of time before
  the \Condor{starter} sends its initial update to the
  \Condor{shadow} by defining
  \Macro{STARTER\_INITIAL\_UPDATE\_INTERVAL}. 
  The default is 8 seconds.
  This setting would not normally need changing except to fine-tune a
  heavily loaded system.

\item Administrators can now specify the default session duration for
  each Condor subsystem.
  This allows for fine tuning the image size of running Condor daemons
  if the memory footprint is a concern.
  The default for tools is 1 minute, the default for \Condor{submit}
  is one hour, and the default for daemons is 100 days.
  This does not mean that tools cannot run more than one minute or
  submit cannot run for more than an hour; it only affects memory
  usage.

\item Added new configuration setting
  \Macro{GRID\_MONITOR\_HEARTBEAT\_TIMEOUT}.
  If this many
  seconds pass without hearing from the grid\_monitor, it is
  assumed to be dead.  Defaults to 300 (5 minutes).  Increasing
  this number will improve the ability of the grid\_monitor to
  survive in the face of transient problems but will also
  increase the time before Condor notices a problem.  Prior to
  this change the gridmanager always waited 5 minutes, the user
  could not change the setting.

\item Added new configuration setting
  \Macro{GRID\_MONITOR\_RETRY\_DURATION}.  
  If something goes wrong
  with the grid\_monitor at a particular site (like
  \MacroNI{GRID\_MONITOR\_HEARTBEAT\_TIMEOUT} expiring), it will be retried
  for this many seconds.  Defaults to 900 (15 minutes).  If we
  can't successfully get it going again the grid monitor will be
  disabled for that site until 60 minutes have passed.  Prior to
  this change the condor\_gridmanger wait 60 minutes after any
  failure.

\end{itemize}



\noindent Bugs Fixed:

\begin{itemize}

\item Fixed bugs related to network communication and timeouts that
  impact scalability in Condor:
  \begin{itemize}
    \item Fixed a bug inside Condor's network communication layer that 
      could result in Condor daemons blocking trying to read more data
      after a socket had already been closed.
    \item Fixed a \Condor{negotiator} bug that could, in certain rare
      circumstances, cause a \Condor{schedd} to hang for five minutes
      while trying to communicate with it.
    \item Fixed a bug in which TCP connections would reauthenticate
      needlessly when Condor's strong authentication was enabled.
      This was not harmful but incurred a bit of overhead, especially
      when using Kerberos authentication.
  \end{itemize}

\item Fixed bugs related to network security sessions which were
  getting cleared out.
  If the timing was unfortunate, this could cause some jobs to fail
  immediately after completion.
  So, Condor no longer clears out security sessions periodically (it
  used to happen every 8 hours) nor does it do so when a daemon
  receives a \Condor{reconfig} command.

\item Fixed a bug in the standard universe where C++ code that threw an 
exception would result in abortion of the executable instead of the
delivery of the exception. This bug affects Condor version 6.6.0 for
Redhat 7.x.

\item Fixed a \Condor{shadow} bug that could result in a fatal error
  if the following 3 conditions were met: (1) the job enables Condor's
  file transfer mechanism, (2) the job wants Condor to automatically
  figure out what files to transfer back (the default), and (3) the
  job does not specify a userlog.

\item Fixed bug whereby \Condor{dagman}, if removed from the queue via
      \Condor{rm}, could fail to remove all of its submitted jobs if
      any of their submit events had not yet appeared in the userlog.

\item Fixed a few bugs in \Condor{preen}:
  \begin{itemize}
  \item It will no longer potentially remove files related to a valid
    Computing on Demand (COD) claim on an otherwise idle machine.
  \item \Condor{preen} will no longer keep reporting that it had
    successfully removed a directory which was in fact failing to be
    removed.
  \end{itemize}

\item Fixed the faulty argument parsing in \Condor{rm},
  \Condor{release}, and \Condor{hold}.
  Before you could accidentally type \verb@condor_rm -analyze@, and it
  would remove all of your jobs.
  Now it gives an error.

\item On Windows, when you type a command like
  \verb@condor_reconfig.exe@ instead of \verb@condor_reconfig@, you no
  longer get an error.

\item Fixed a bug on Windows that would cause ``GetCursorPos() failed''
  to appear repeatedly in the StartLog. The startd now uses a different
  function to track mouse activity that does not have a tendency to fail.

\item Fixed a bug on Windows that would prevent some \Condor{shadow}
  daemons from obtaining a lock to their log file under heavy load, and
  thus causing them to EXCEPT().

\item Fixed a bug on Windows where file transfers would incorrectly fail
because of bad permissions when using domain accounts with nested groups,
or when UNC paths were used.

\item Fixed the bug where the \Condor{starter} would fail to transfer
  back core files created by Vanilla, Java and MPI universe jobs.
  This bug was introduced in Condor version 6.5.2.
  Now, Condor correctly transfers back any core files created by
  faulty user jobs in any job universe.

\item In some circumstances, \Condor{history} would fail to read
  information about some jobs, and would report errors. In particular,
  when jobs had large environments, it would fail. This has been
  corrected.

\item Fixed a rare bug affecting \Condor{dagman} when job-throttling
      was enabled: if \Condor{dagman} was removed from the queue
      together with some of its own jobs (e.g., via \verb@condor_rm -a@),
      it would quickly submit new jobs to replace them before
      recognizing that it needs to exit.  It now shuts down
      immediately without submitting and then removing these
      unnecessary jobs.

\item Fixed a potential security problem that was introduced in Condor
  version 6.5.5 when the \Macro{REQUIRE\_LOCAL\_CONFIG\_FILE}
  configuration setting was added.
  This setting used to default to FALSE if it was not defined in the
  configuration files.
  It now defaults to TRUE.
  If administrators define local configuration files for the machines
  in their pool, it should be a fatal error if those files don't exist
  unless the administrators actively disable this check by defining 
  \MacroNI{REQUIRE\_LOCAL\_CONFIG\_FILE} to be FALSE.

\item Fixed a bug on Windows that would cause the \Condor{startd} to
EXCEPT() if the \Condor{starter} exited and left orphaned processes to
be cleaned up. This bug first appeared in 6.5.0.

\item Fixed a bug on Windows that would cause graceful shutdowns on
Windows (such as when \verb@condor_vacate@  is called) to fail to
complete.

\item The gahp\_server helper program, which provides Globus services
to Condor-G, was always dynamically linked, even in statically-linked
releases.
The statically linked distributions of Condor now include a static
gahp\_server.

\item Fixed minor bug in parsing XML user log files that contain empty
  strings. 

\item Fixed the messages written to the Condor daemon log files in
  various error conditions to be more informative and clear:
  \begin{itemize}
  \item The error message in the SchedLog that indicates that swap
    space has been depleted has been rephrased so it appears to be
    significant.
  \item Certain serious error messages are now being written to the 
    \Dflag{ALWAYS} debug level that used to only appear if other debug
    levels were enabled.
  \item Clarified log messages related to errors looking up user
    information in the passwd database on UNIX and for creating
    dynamic users on Windows.
  \item Log messages related to keep-alives sent between the
    \Condor{schedd} and \Condor{startd} (written to \Dflag{PROTOCOL})
    now include the \Attr{ClaimId} on both sides, so that it is easier
    to find potential problems and figure out which keep-alive
    messages correspond to what resources.
  \item Added more useful information to certain errors relating to 
    security sessions and strong authentication.
  \item Fixed the formatting of some messages to correctly include a
    newline at the end of the message.
  \end{itemize}

\item Fixed a bug in the \Condor{configure} installation tool.
  Previously, it would set \MacroNI{MAIL\_PATH}, which doesn't exist
  in Condor and had no effect.
  Now, \Condor{configure} correctly sets \Macro{MAIL}, instead.

\item Fixed bug in userlog code in the CondorAPI library to prevent
  segmentation faults.

\item Clarified log messages for Condor-G's GridmanagerLog,
  especially those relating to the grid monitor.

\item Fixed potential race condition when using the grid monitor.  
  Condor-G now identifies partial grid monitor status updates and 
  waits for the update to complete.


\item The grid\_monitor is slightly more robust in the face of
  unexpected behavior by the Globus jobmanager.  This is only a
  partial fix, for complete success you really need the Globus
  patch at
  \URL{http://bugzilla.globus.org/bugzilla/show\_bug.cgi?id=1425}

\item Internal timeouts in the grid\_monitor have been increased,
  increasing robustness during transient errors.

\end{itemize}

\noindent Known Bugs:

\begin{itemize}

\item Submission of MPI jobs from a Unix machine to run on Windows
machines (or vice versa) fails for machine\_count > 1.  This is
not a new bug.  Cross-platform submission of MPI jobs between
Unix and Windows has always had this problem.

\item A multiple install of Condor's standard universe support libraries
onto an NFS server for the purposes of having a heterogeneous mix of Linux
distribution revisions all being able to utilize the same \Condor{compile}
does not function correctly if Redhat 9 is one of the distributions.

\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{\label{sec:New-6-6-0}Version 6.6.0}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent New Features:

\begin{itemize}

\item The \Condor{dagman} debugging log now reports the total number
      of ``Un-Ready'' Nodes (i.e. those waiting for unfinished
      dependencies) in its periodic summaries.  In the past, the
      omission of this state led to confusion because the total of all
      reported job states didn't always match the total number of jobs
      in the DAG.

\item Most Condor commands (\Condor{on}, \Condor{off},
  \Condor{restart}, \Condor{reconfig}, \Condor{vacate},
  \Condor{checkpoint}, \Condor{reschedule}) now support a \Opt{-all}
  command-line option to specify which daemons to act on.
  This is more efficient and much easier to use than previous methods
  for accomplishing the same effect.
  Using \Opt{-all} with \Condor{off} correctly leaves the existing
  \Condor{master} processes running on each host, so that a subsequent
  \Condor{on} would work.
  See section~\ref{sec:Pool-Shutdown-and-Restart} on
  page~\pageref{sec:Pool-Shutdown-and-Restart} for more details on
  proper use of \Opt{-all} with \Condor{off} and \Condor{on}

\end{itemize}

\noindent Bugs Fixed:

\begin{itemize}

\item Fixed a bug under Solaris 8 with Update 6+, and Solaris 9 where
Condor would incorrectly report the console and mouse idle times as zero.

\item The standard-universe fetch\_files feature was not cleaning up
temporary files on the execution machine.

\item In rare circumstances, a Linux kernel bug results in conflicting
information about system boot time (\File{/proc/stat} and
\File{/proc/uptime}). 
Specifically, the "btime" field in \File{/proc/stat} suddenly jumps to
the present moment and then stays at that value.  This
was resulting in incorrect estimation of process ages, which caused
Condor's estimation of CondorLoadAvg to be completely wrong.  A more
robust heuristic is now being used.

\item A long configuration line with with continuation lines can cause the
config file parser to not properly skip the leading whitespace from
the continued lines.  This has been corrected.

\item The Grid Monitor now will automatically probe for and work with
``unknown'' batch systems.

\item Fixed a bug where under certain circumstances \Condor{dagman}
      would fail to detect an unsuccessful invocation of
      \Condor{submit}, and would instead report the job as
      successfully submitted with job id 0.0.

\item Fixed a bug which was causing problems when a periodic\_remove
expression for a scheduler universe job evaluates to true.  Under
these conditions, the schedd did not log the job terminiation to the
job log.  Addtionally, the schedd would exit with an error status.

\item Fixed a recently-introduced \Condor{dagman} bug where the number
      of node retries (specified with the RETRY keyword) wasn't being
      updated after some failures; instead, the node would be allowed
      to retry indefinitely if it kept failing.

\item Fixed a recently-introduced bug where shutting down the
      \Condor{schedd} caused \Condor{dagman} to remove all its jobs
      from the queue and write a rescue file, rather than simply
      exiting so that it could recover automatically upon restart.

\item Changed the default ``Periodic Expression Interval'' parameter
(PERIODIC\_EXPR\_INTERVAL) from 60 seconds to 300 seconds.

\item Whenever \Condor{reconfig} was used to re-configure multiple
  daemons which included the \Condor{collector} for a pool, the
  command would start to fail after the \Condor{collector} was
  reconfigured due to problems with security sessions in Condor's
  strong authentication code.
  This situation no longer causes problems for the \Condor{reconfig}
  tool, and it can properly re-configure multiple daemons at once,
  even if one of them is the \Condor{collector} for a pool.

\item Most Condor commands (\Condor{on}, \Condor{off},
  \Condor{restart}, \Condor{reconfig}, \Condor{vacate},
  \Condor{checkpoint}, \Condor{reschedule}) now check to make sure
  they are not sending a duplicate command if the user specifies the
  same target machine or daemon twice.  For example:
\begin{verbatim}
     condor_reconfig hostname1 hostname2 hostname1
\end{verbatim}
  will only send a single reconfig command to \verb@hostname1@.

\item Fixed a bug in the HPUX version of Condor which was causing the
startd to occasionally abort operation.  This has been in Condor since
version 6.1.1.

\item The Condor daemons will no longer overwhelm NIS servers
when large numbers of daemons are running. Condor now caches
uid and group information internally, and refreshes the
cache entries on a specified interval (which defaults to 5
minutes). See section~\ref{param:PasswdCacheRefresh} on
page~\pageref{param:PasswdCacheRefresh} for more details.

\end{itemize}

\noindent Known Bugs:

\begin{itemize}

\item The \Condor{preen} program does not know about Computing on
  Demand (COD) claims.
  If there are no regular Condor jobs on a given machine, but there
  are COD claims, and \Condor{preen} is spawned, it will remove files
  related to the COD claims.
  In version 6.6.0, sites using COD are encouraged to disable
  \Condor{preen} by commenting out the \MacroNI{PREEN} setting in the
  config files.
  This bug has been fixed in Condor version 6.6.1.

\item Normally, if a user's job crashes and creates a core file on a
  remote execution machine, the \Condor{starter} will automatically
  transfer the core file back to the submit machine.
  However, beginning in Condor version 6.5.2, if a vanilla, Java, or
  MPI universe job creates a core file, the \Condor{starter} will fail
  to transfer it back.
  This bug will be fixed in version 6.6.1.
  
\item There are a few bugs related to Condor tools failing to
  correctly locate the \Condor{negotiator} daemon.
  These bugs usually show up if a site is using non-standard ports for
  the central manager daemon.
  However, some of the bugs show up regardless of if the negotiator is
  listening on the standard port or not. 

  \begin{itemize}
    \item \verb@condor_config_val -negotitator@ queries the
          \Condor{collector}, instead of querying the
          \Condor{negotiator} like it should.  

    \item Using the \Opt{-pool} option to \verb@condor_q -analyze@
          will not work.
          The tool will fail to find and query the \Condor{negotiator}
          for user priorities which it needs to determine why jobs may
          not be running.

    \item The Condor tools that support either the \Opt{-negotiator}
          or \Opt{-collector} options do not work when a user also
          specifies the \Opt{-pool} to define a remote pool to
          communicate with.
          The tools print a somewhat confusing message in this case.

    \item Most Condor tools that support \verb@-pool hostname@ will
          also recogize \verb@-pool hostname:port@ if the remote
          \Condor{collector} is listening on a non-standard port.
          However, the \Condor{findhost} tool does not work if given a
          \Opt{-pool} option that includes a port.

  \end{itemize}

\end{itemize}

\begin{center}
\begin{table}[hbt]
\begin{tabular}{|ll|} \hline
\emph{Architecture} & \emph{Operating System} \\ \hline \hline
Hewlett Packard PA-RISC (both PA7000 and PA8000 series) & HPUX 10.20 \\ \hline
Sun SPARC Sun4m,Sun4c, Sun UltraSPARC & Solaris 2.6, 2.7, 8, 9 \\ \hline
Silicon Graphics MIPS (R5000, R8000, R10000) & IRIX 6.5 \\ \hline
Intel x86 & Red Hat Linux 7.1, 7.2, 7.3 \\
 & Red Hat Linux 8 (clipped) \\ \hline
 & Red Hat Linux 9 (clipped) \\ \hline
 & Windows NT 4.0 Workstation and Server (clipped) \\ \hline
 & Windows 2000 Professional and Server, 2003 Server (clipped) \\ \hline
 & Windows XP Professional (clipped) \\ \hline
ALPHA & Digital Unix 4.0 \\
 & Red Hat Linux 7.1, 7.2, 7.3 (clipped) \\ \hline
 & Tru64 5.1 (clipped) \\ \hline
PowerPC & Macintosh OS X (clipped) \\
Itanium & Red Hat Linux 7.1, 7.2, 7.3 (clipped) \\
\end{tabular}
\caption{\label{6.6.0-supported-platforms}Condor version 6.6.0 supported platforms}
\end{table}
\end{center}

