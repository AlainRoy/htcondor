#!/bin/sh

# I need to be aware of which distribution I'm using
. $EXTERNALS_CONFIG

CC=gcc
export CC


patch -p0 < configure.patch
if [ $? -ne 0 ]
then
    echo "patch failed: configure.patch"
    exit 1
fi

patch -p0 < includes.patch
if [ $? -ne 0 ]
then
    echo "patch failed: includes.patch"
    exit 1
fi

patch -p0 < makefile.patch
if [ $? -ne 0 ]
then
    echo "patch failed: makefile.patch"
    exit 1
fi

patch -p0 < initializer.patch
if [ $? -ne 0 ]
then
    echo "patch failed: initializer.patch"
    exit 1
fi

cd $PACKAGE_BUILD_DIR/$PACKAGE_SRC_NAME

./configure --prefix=$PACKAGE_INSTALL_DIR --with-api-only --with-openssl-prefix=$EXTERNALS_INSTALL_DIR/$EXT_OPENSSL_VERSION --with-expat-prefix=$EXTERNALS_INSTALL_DIR/$EXT_EXPAT_VERSION --with-globus-prefix=$EXTERNALS_INSTALL_DIR/$EXT_GLOBUS_VERSION --disable-java --disable-docs  --disable-glite 

if [ $? -ne 0 ]
then
  echo "configure failed"
  exit 1
fi

make
if [ $? -ne 0 ]
then
  echo "make failed"
  exit 1
fi

make install
if [ $? -ne 0 ]
then
  echo "install failed"
  exit 1
fi

if [ -d $PACKAGE_INSTALL_DIR/lib64 ] 
then
  ln -s lib64 $PACKAGE_INSTALL_DIR/lib
fi
