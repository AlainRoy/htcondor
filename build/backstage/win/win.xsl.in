<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0"
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
   xmlns:wix="http://schemas.microsoft.com/wix/2006/wi">
  <xsl:output indent="yes" method="xml"/>

  <xsl:template match="/wix:Wix">
    <Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
      <Product xmlns="http://schemas.microsoft.com/wix/2006/wi" Id="@CPACK_WIX_PRODUCT_GUID@" Name="@CPACK_PACKAGE_FILE_NAME@" Language="1033" Version="@CPACK_PACKAGE_VERSION@" Manufacturer="@CPACK_PACKAGE_VENDOR@" UpgradeCode="@CPACK_WIX_UPGRADE_GUID@">
        <Package InstallerVersion="200" Compressed="yes" />
        <Media Id="1" Cabinet="media1.cab" EmbedCab="yes" />
        <Directory Id="TARGETDIR" Name="SourceDir"  >
          <Directory Id="ProgramFilesFolder" Name="PFiles">
            <Directory Id="APPLICATIONFOLDER" Name="@CPACK_PACKAGE_INSTALL_DIRECTORY@"/>
          </Directory>
        </Directory>
        <Feature Id="CondorWindows" Title="@CPACK_PACKAGE_FILE_NAME@" Level="1">
          <!-- Start Ripping through the xml -->
          <xsl:apply-templates select="wix:Fragment" />          
        </Feature>
        
        <Property Id="ApplicationFolderName" Value="@CPACK_PACKAGE_INSTALL_DIRECTORY@" />
        <Property Id="WixAppFolder" Value="WixPerMachineFolder" />
        
        <!--Tack on your specific wix options-->
        <UIRef Id="WixUI_Advanced" />
        <UIRef Id="WixUI_ErrorProgressText" />
        <!-- TODO: Add Wix Specific Dialogs and features. -->
        <!-- TODO: Add artwork  -->
        <!-- TODO: Add ... -->

      </Product>

      <!--Output the fragment info which heat generates-->
      <xsl:copy-of select="./*" />
            
    </Wix>
  </xsl:template>

  <!-- Unused atm
  <xsl:template match="wix:File">      
  </xsl:template>-->

  <xsl:template match="wix:Component">
    <xsl:element name="ComponentRef" xmlns="http://schemas.microsoft.com/wix/2006/wi" >
      <xsl:attribute name="Id">
        <xsl:value-of select="@Id" />
      </xsl:attribute>
    </xsl:element>
  </xsl:template>

  <xsl:template match="wix:Directory">
    <xsl:apply-templates select="wix:Component" />
    <xsl:apply-templates select="wix:Directory" />
  </xsl:template>

  <xsl:template match="wix:DirectoryRef">
    <xsl:apply-templates select="wix:Component" />
    <xsl:apply-templates select="wix:Directory" />
  </xsl:template>

  <xsl:template match="wix:Fragment">
    <!--Create the comonent references from the output of heat-->
    <xsl:apply-templates select="wix:DirectoryRef" />
  </xsl:template>

</xsl:stylesheet>